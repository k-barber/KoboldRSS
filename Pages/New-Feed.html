<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="/Pages/styles.css">
    <title>RSS-Manager: New Feed</title>
</head>

<body>
    <a href="/"><img src="/Bocchi.png" id="bocchi" /></a>
    <div id="container">
        <div>
            <a href="https://validator.w3.org/feed/docs/rss2.html" target="_blank"><img id="icon" src="RSS.png"></a>
            <p><a href="/">Home</a> > New Feed</p>
            <h1>K-Barber's RSS-Manager: Add a Feed</h1>
            <p>Creating a new feed is easy, just follow the instructions below.</p>
            <p>We'll start by defining some features of the RSS feed. Fields marked with a <span class="required">*</span> are mandatory.</p>
            </br>
            <hr>
            </br>
            <h2>Defining the Feed</h2>
            <form novalidate id="Feed_Data">
                <p><span class="required">*</span> First, select a URL to be monitored for updates: </p>
                <div class="padding">
                    <input id="Feed_Link" name="Feed_Link" class="input_box" type="url" required>
                </div>
                <p><span class="required">*</span> Give the feed a name: </p>
                <div class="padding">
                    <input id="Feed_Title" name="Feed_Title" class="input_box" type="text" required>
                </div>
                <p><span class="required">*</span> Give the feed a description: </p>
                <div class="padding">
                    <textarea id="Feed_Description" name="Feed_Description" class="input_box" rows="10" cols="100" required></textarea>
                </div>
                <p>How often should the feed check for updates? (In minutes, rounding to the nearest 5)</p>
                <div class="padding">
                    <div id="left_button" onclick="down5()">-</div><input id="Feed_TTL" name="Feed_TTL" class="input_box" type="number" min="5" value="5" step="5" /><div id="right_button" onclick="up5()">+</div>
                </div>
                <p>What category/categories does the feed fall under? Separate values with a space. </p>
                <div class="padding">
                    <input id="Feed_Categories" name="Feed_Categories" class="input_box" type="text">
                </div>
                <p>Does the feed have any applicable copyright info?</p>
                <div class="padding">
                    <input id="Feed_Copyright" name="Feed_Copyright" class="input_box" type="text">
                </div>
                <p>Use a custom image?</p>
                <div class="padding">
                    <input type="radio" name="Feed_Image" value="False" onclick="hide()" checked><span>No</span></input>
                    <input type="radio" name="Feed_Image" value="True" onclick="show()"><span>Yes</span></input>
                </div>
                <div id="custom_image" class="padding" style="display: none;">
                    <p><span class="required">*</span> Where does the Image link to? (Normally the same as the feed url)</p>
                    <div class="padding">
                        <input id="Image_Link" name="Image_Link" class="input_box" type="url">
                    </div>
                    <p><span class="required">*</span> Image Title:</p>
                    <div class="padding">
                        <input id="Image_Title" name="Image_Title" class="input_box" type="text">
                    </div>
                    <p><span class="required">*</span> Image URL: (Needs to point directly to image)</p>
                    <div class="padding">
                        <input id="Image_URL" name="Image_URL" class="input_box" type="url">
                    </div>
                </div>
                <p>What language is the feed in?</p>
                <div class="padding">
                    <select id="Feed_Language" name="Feed_Language" class="input_box">
                        <option value="af">Afrikaans</option>
                        <option value="sq">Albanian</option>
                        <option value="eu">Basque</option>
                        <option value="be">Belarusian</option>
                        <option value="bg">Bulgarian</option>
                        <option value="ca">Catalan</option>
                        <option value="zh-cn">Chinese (Simplified)</option>
                        <option value="zh-tw">Chinese (Traditional)</option>
                        <option value="hr">Croatian</option>
                        <option value="cs">Czech</option>
                        <option value="da">Danish</option>
                        <option value="nl">Dutch</option>
                        <option value="en">English</option>
                        <option value="en-au">English (Australia)</option>
                        <option value="en-ca">English (Canada)</option>
                        <option value="en-uk">English (United Kingdom)</option>
                        <option value="en-us">English (United States)</option>
                        <option value="et">Estonian</option>
                        <option value="fo">Faeroese</option>
                        <option value="fi">Finnish</option>
                        <option value="fr">French</option>
                        <option value="fr-ca">French (Canada)</option>
                        <option value="fr-fr">French (France)</option>
                        <option value="fr-ch">French (Switzerland)</option>
                        <option value="gl">Galician</option>
                        <option value="gd">Gaelic</option>
                        <option value="de">German</option>
                        <option value="de-de">German (Germany)</option>
                        <option value="de-cg">German (Switzerland)</option>
                        <option value="el">Greek</option>
                        <option value="haw">Hawaiian</option>
                        <option value="hu">Hungarian</option>
                        <option value="is">Icelandic</option>
                        <option value="in">Indonesian</option>
                        <option value="ga">Irish</option>
                        <option value="it">Italian</option>
                        <option value="ja">Japanese</option>
                        <option value="ko">Korean</option>
                        <option value="mk">Macedonian</option>
                        <option value="no">Norwegian</option>
                        <option value="pl">Polish</option>
                        <option value="pt">Portuguese</option>
                        <option value="pt-br">Portuguese (Brazil)</option>
                        <option value="pt-pt">Portuguese (Portugal)</option>
                        <option value="ro">Romanian</option>
                        <option value="ru">Russian</option>
                        <option value="sr">Serbian</option>
                        <option value="sk">Slovak</option>
                        <option value="sl">Slovenian</option>
                        <option value="es">Spanish</option>
                        <option value="es-mx">Spanish (Mexico)</option>
                        <option value="es-pr">Spanish (Puerto Rico)</option>
                        <option value="es-es">Spanish (Spain)</option>
                        <option value="sv">Swedish</option>
                        <option value="tr">Turkish</option>
                        <option value="uk">Ukranian</option>
                    </select>
                </div>
                <p>Does the feed have a managing editor? (The fact that you are using this tool would suggest not)</p>
                <div class="padding">
                    <input id="Feed_Editor" name="Feed_Editor" class="input_box" type="text">
                </div>
                <p>Does the feed have a webmaster? (The fact that you are using this tool would suggest not)</p>
                <div class="padding">
                    <input id="Feed_Webmaster" name="Feed_Webmaster" class="input_box" type="text">
                </div>
                </br>
                <hr>
                </br>
                <h2>Creating An Item Pattern</h2>
                <p>Next up, we'll create an Item Pattern. The program will load the page from the feed link, then scan it for the item pattern, turning anything that matches into an item in the RSS feed.</p>
                <p>Click the button below to get the data from the feed link.</p>
            </form>
            <button onclick="scrape_URL()">Scrape URL</button>
            <div id="Item_Definition" style="display: none;">
                <p>Scraped page source data: </p>
                <textarea readonly id="Page_Source" rows="10" cols="100" class="input_box"></textarea>
                <p>This is where things start to get complicated. Look through the data above and find an example of an item you want in the feed.</p>
                <p>Copy that item into the box below, and replace any <span class="required">dynamic</span> text with either {*} for data you don't want to keep, or a {%} for data you do want to keep</p>
                <p>Item Patttern:</p>
                <textarea id="Item_Pattern" rows="10" cols="100" class="input_box"></textarea>
                </br>
                <button onclick="test_pattern()">Test Pattern</button>
                <div id="Pattern_Results" style="display: none;">
                    <p>Items Found: <span id="Item_Total"></span></p>
                    <textarea readonly id="Item_List" rows="10" cols="100" class="input_box"></textarea>
                    <p>The above box displays a list of items that matched the Item Pattern. The dynamic fields that you kept are also listed and numbered, so dynamic field 1 is listed as {%1} and so on.</p>
                    </br>
                    <hr/>
                    </br>
                    <h2>Defining the Items</h2>
                    <p>This is where you define how the items in the RSS feed will be formatted. If you type "{%1}" anywhere in the rest of the form it will be replaced by the first dynamic field of that item. {%2} will be replaced with the second dynamic field and so on.</p>
                    <p>Anything else you type will be the same for every item in the feed.</p>
                </div >
            </div>
        </div>
    </div>
    <script>
        function validateForm() {
            var radios = document.getElementsByName('Feed_Image');
            var use_image;
            for (var i = 0, length = radios.length; i < length; i++) {
                if (radios[i].checked) {
                    use_image = radios[i].value;
                    break;
                }
            }
            var e = document.getElementById("Feed_Language");
            var lang = e.options[e.selectedIndex].value;
            console.log("Feed Title: " + document.getElementById("Feed_Title").value);
            console.log("Feed Link: " + document.getElementById("Feed_Link").value);
            console.log("Feed Description: " + document.getElementById("Feed_Description").value);
            console.log("Feed TTL: " + document.getElementById("Feed_TTL").value);
            console.log("Feed Categories: " + document.getElementById("Feed_Categories").value);
            console.log("Feed Copyright: " + document.getElementById("Feed_Copyright").value);
            console.log("Feed Image: " + use_image);
            console.log("Image Link: " + document.getElementById("Image_Link").value);
            console.log("Image Title: " + document.getElementById("Image_Title").value);
            console.log("Image URL: " + document.getElementById("Image_URL").value);
            console.log("Feed Language: " + lang);
            console.log("Feed Editor: " + document.getElementById("Feed_Editor").value);
            console.log("Feed Webmaster: " + document.getElementById("Feed_Webmaster").value);
            console.log("Valid: " + document.getElementById("Feed_Data").reportValidity());
            return document.getElementById("Feed_Data").reportValidity();
        }

        function submit_form() {
            if (validateForm()){
                post_data()
                document.getElementById("Item_Definition").style.display = "block";
            }
        }

        function scrape_URL(){
            var link = document.getElementById("Feed_Link");
            var url = link.value;
            if((url != null) & (link.checkValidity())){
                var xhr = new XMLHttpRequest();
                xhr.onload = function() {
                    console.log(xhr.response);
                    document.getElementById("Page_Source").value = xhr.response;
                    document.getElementById("Item_Definition").style.display = "block";
                };
                xhr.open('POST', '/Get_Source');
                xhr.send(url);
            }
        }

        function test_pattern(){
            var body = document.getElementById("Item_Pattern").value
            if((body != null) & (document.getElementById("Item_Pattern").checkValidity())){
                var xhr = new XMLHttpRequest();
                xhr.onload = function() {
                    var array = JSON.parse(xhr.response);
                    console.log(array);
                    document.getElementById("Pattern_Results").style.display = "block";
                    var output = "";
                    var i = 1;
                    array.forEach(function(item){
                        output += "-----------------\n";
                        output += "Item: " + String(i) + "\n";
                        f = 1;
                        item.forEach(function(field){
                            output += "{%" + String(f) + "}: " + field + "\n";
                            f += 1;
                        });
                        i += 1;
                    });
                    document.getElementById("Item_List").value = output;
                    document.getElementById("Item_Total").innerText = String(array.length);
                };
                xhr.open('POST', '/Test_Pattern');
                xhr.send(body);
            }
            
        }

        function post_data(){
            var xhr = new XMLHttpRequest();
                xhr.onload = function() {
                    console.log(xhr.response);
                };
                xhr.open('POST', "/");
                xhr.send(new FormData(document.getElementById("Feed_Data")));
        }

        function up5() {
            var box = document.getElementById("Feed_TTL");
            if (box.value >= 5) {
                var temp = parseInt(box.value) + 5;
                box.value = Math.ceil(temp / 5) * 5;
            } else {
                box.value = 5;
            }
        }

        function down5() {
            var box = document.getElementById("Feed_TTL");
            if (box.value >= 10) {
                var temp = parseInt(box.value) - 5;
                box.value = Math.floor(temp / 5) * 5;
            } else {
                box.value = 5;
            }
        }

        function hide() {
            document.getElementById("custom_image").style.display = "none";
            document.getElementById("Image_Link").required = false;
            document.getElementById("Image_Title").required = false;
            document.getElementById("Image_URL").required = false;
            document.getElementById("Image_Link").formnovalidate = true;
            document.getElementById("Image_Title").formnovalidate = true;
            document.getElementById("Image_URL").formnovalidate = true;
        }

        function show() {
            document.getElementById("custom_image").style.display = "block";
            document.getElementById("Image_Link").required = true;
            document.getElementById("Image_Title").required = true;
            document.getElementById("Image_URL").required = true;
            document.getElementById("Image_Link").formnovalidate = false;
            document.getElementById("Image_Title").formnovalidate = false;
            document.getElementById("Image_URL").formnovalidate = false;
        }
    </script>
</body>

</html>