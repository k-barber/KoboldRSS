<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="/Pages/styles.css">
    <title>RSS-Generator: Feeds</title>
</head>

<body onload="load()">
    <a href="/"><img src="/Img/Bocchi.png" id="bocchi" /></a>
    <div id="container">
        <div>
            <a href="http://www.rssboard.org/rss-draft-1" target="_blank"><img id="icon" src="/Img/RSS.png"></a>
            <p id="bread-crumbs"><a href="/">Home</a></p>
            <h1>K-Barber's RSS-Generator: My Feeds</h1>
            <p>A list of your feeds:</p>
            <div id="file-list">
                <table id="file-table">
                    <colgroup>
                        <col style="width: 60%;">
                    </colgroup>
                    <tr>
                        <th>Name</th>
                        <th>Size</th>
                        <th>Modified</th>
                    </tr>
                </table>
            </div>
            <button onclick="refresh()">Refresh</button>
        </div>
    </div>
    <script>
        var items = [];

        const ALPHABETICAL = 1;
        const SIZE = 2;
        const MODIFIED = 3;

        function refresh() {
            location.reload(true);
        }

        function folder_first_compare(a, b, mode = ALPHABETICAL, descending = false) {
            if (a.is_dir && !b.is_dir) {
                return -1
            } else if (!a.is_dir && b.is_dir) {
                return 1
            }

            var result = 1;
            if (mode == ALPHABETICAL) {
                if (a.name < b.name) {
                    result = -1;
                }
            } else if (mode == SIZE) {
                if (a.size < b.size) {
                    result = -1
                }
            } else if (mode == MODIFIED) {
                if (a.modified < b.modified) {
                    result = -1;
                }
            }

            if (descending) {
                result = result * -1;
            }

            return result
        }

        function load() {
            var path = location.pathname.split("/");
            var filtered = path.filter(function (value, index, array) {
                return value !== ""
            });

            var crumbs = ""
            var i;
            for (i = 0; i < filtered.length; i++) {
                if (i == (filtered.length - 1)) {
                    crumbs += " &gt; " + decodeURIComponent(filtered[i]);
                } else {
                    url = decodeURIComponent(filtered.slice(0, i + 1).join("/"))
                    crumbs += " &gt; <a href='/" + url + "'> " + decodeURIComponent(filtered[i]) + "</a>"
                }
            }
            document.getElementById("bread-crumbs").innerHTML += crumbs;


            for (index in items) {
                var name;
                if (items[index].is_dir == false) {
                    items[index].name = items[index].name.slice(0, items[index].name.indexOf("."));
                } else {
                    items[index].name = items[index].name;
                }
            }

            items.sort(folder_first_compare);

            fill_table()
        }

        function fill_table() {
            var previous = location.pathname.substring(0, location.pathname.lastIndexOf("/"))
            var prev_folder = "<tr><td><a class='list_name' href='" + previous + "'><img class='list_icon' src='/Img/Icons/folder.svg'>..</a></td><td></td><td></td>";
            document.getElementById("file-table").innerHTML += prev_folder;
            for (index in items) {
                var html_item = "<tr><td><a class='list_name' href='" + location + "/" + encodeURIComponent(items[index].name) + "'>";
                if (items[index].is_dir) {
                    html_item += '<img class="list_icon" src="/Img/Icons/folder.svg">';
                } else {
                    html_item += '<img class="list_icon" src="/Img/Icons/file-richtext.svg">';
                }
                html_item += items[index].name + "</a></td>";
                if (items[index].is_dir) {
                    html_item += "<td></td>";
                } else {
                    html_item += "<td>" + formatBytes(items[index].size) + "</td>";
                }
                items[index].modified = new Date(items[index].modified * 1000)
                html_item += "<td>" + items[index].modified.toLocaleDateString('en-CA') + "</td></tr>";
                document.getElementById("file-table").innerHTML += html_item;
            }
        }

        function formatBytes(a, b = 2) {
            if (0 === a) return "0 Bytes";
            const c = 0 > b ? 0 : b,
                d = Math.floor(Math.log(a) / Math.log(1024));
            return parseFloat((a / Math.pow(1024, d)).toFixed(c)) + " " + ["Bytes", "KB", "MB", "GB", "TB", "PB", "EB", "ZB", "YB"][d]
        }
    </script>
</body>

</html>